<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>document master</title>
    <link rel="stylesheet" type="text/css" href="./node_modules/swagger-ui-dist/swagger-ui.css" >
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&family=Shippori+Antique&display=swap" rel="stylesheet">

    <style>
      /* ----- 共通クラス ----- */
      .hidden { display: none; }
      .is-hidden { display: none !important; }

      /* ----- スクロールBOX ----- */
      .scroll-box {
        width: 300px;
        height: 200px;
        border: 1px solid #333;
        padding: 10px;
        overflow-y: auto;
        background-color: #EEEEEE	;
      }

      /* ----- 左サイドバー ----- */
      #sidebar {
        position: fixed;
        left: 0;
        top: 0;
        width: 220px;
        height: 100vh;
        background: #e7eaf3	;
        color: #7b7b8a;
        padding: 15px 15px;
        box-sizing: border-box;
        border-right: 3px solid #e4e7ed;
        display: flex;
        flex-direction: column;
        z-index: 9999;
      }

      .sidebar-title {
        font-size: 20px;
        margin-bottom: 18px;
        padding-left: 10px;
        opacity: 0.8;
        margin-top:0px;
        color: #212c4c;
        font-family: "Mochiy Pop One", sans-serif;   
        font-weight: 700;   
        font-style: normal; 
      }

      .menu-item {
        background: none;
        border: none;
        color: #7a7f97;
        text-align: left;
        padding: 12px 14px;
        font-size: 15px;
        border-radius: 6px;
        cursor: pointer;
      }

      .menu-div:hover .material-icons,
      .menu-div:hover .menu-item {
        color: #195ff2;
      }

      .menu-div {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
        border-radius: 6px;
        cursor: pointer;
        padding-left: 4px;
      }

      .menu-div:hover {
        background-color: #dfe3ee;
      }

      
      /* ----- メイン表示領域 ----- */
      #mainContent {
        margin-left: 220px; /* サイドバー幅と一致 */
        padding: 20px;
        padding-top: 60px; /* ヘッダー分の余白確保 */
      }

      body{
        font-family: Arial, sans-serif;
        background-color: #f1f5fa;
      }

      /* ----- 固定ヘッダー ----- */
      #topHeader {
        position: fixed;
        top: 0;
        left: 220px; /* サイドバー幅 */
        right: 0;
        height: 50px;
        background: #ffffff;
        display: flex;
        align-items: center;
        padding: 0 20px;
        justify-content: space-between;
        z-index: 9998;
        color: #212c4c
      }
      .header-title { 
        margin-left: 1rem;
        font-size: 18px; 
        font-weight: bold; 
        font-family: "Mochiy Pop One", sans-serif;   
        font-weight: 700;   
        font-style: normal; 
      }
      .header-filename {
        flex: 1;
        text-align: center;
        font-size: 14px;
        color: #555;
      }
      .header-save-btn {
        padding: 6px 14px;
        border: none;
        background: #195ff2;
        color: #fff;
        border-radius: 6px;
        cursor: pointer;
      }
      .header-save-btn:hover { background: #3a76ff; }

      /* ----- Google翻訳風2カラムレイアウト ----- */
      .translate-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        height: calc(100vh - 360px);
      }
      .translate-column {
        display: flex;
        flex-direction: column;
      }

      .translate-column h3 {
        margin-bottom: 6px;
      }

      .translate-textarea {
        flex: 1;
        width: 100%;
        padding: 9.2px;
        font-size: 15px;
        border: 1px solid #d0d7de;
        border-radius: 10px;
        resize: none;
        background: #fff;
      }

      /* ← 追加：ボタンを右寄せするコンテナ */
      #insert-btn-container {
        text-align: right;
        margin-top: 16px;
      }

      #insert-btn {
        padding: 8px 16px;
        background: #195ff2;
        color: #fff;
        border: 1px solid rgba(27,31,36,0.15);
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
      }

      #insert-btn:hover {
        background: #3a76ff;
      }

      .info-alert {
        display: flex;
        align-items: flex-start;
        border: 1px solid #2196f3;    /* 情報色のアウトライン */
        background-color: #e3f2fd;     /* 薄い青背景 */
        color: #0d47a1;               /* 濃い青文字 */
        padding: 12px 16px;
        border-radius: 6px;
        font-size: 14px;
        margin-bottom: 15px;
      }

      /* 左のアイコン */
      .icon-alert {
        font-size: 20px;
        margin-right: 10px;
        line-height: 1.2;
      }

      /* テキスト部分 */
      .text-alert {
        line-height: 1.5;
      }

      .alert-danger-text {
        color: #e9665d;  /* Google風の強調レッド */
        font-weight: 600;
      }

      /* PPTX モダン設定フォーム */
      .pptx-setting {
        display: grid;
        grid-template-columns: 1fr 1fr;   /* 2列レイアウト */
        gap: 14px 20px;
        margin: 20px 0;
      }

      .pptx-setting label {
        font-size: 14px;
        font-weight: 600;
        color: #24292f;
      }

      .pptx-setting input {
        width: 100%;
        padding: 8px 10px;
        font-size: 14px;
        border: 1px solid #d0d7de;
        border-radius: 6px;
        background: #fff;
        transition: 0.15s ease;
      }

      /* フォーカス時（モダン感UP） */
      .pptx-setting input:focus {
        border-color: #195ff2;
        box-shadow: 0 0 0 3px rgba(25, 95, 242, 0.2);
        outline: none;
      }

      /* ホバー効果（軽い印象） */
      .pptx-setting input:hover {
        border-color: #a6b5c3;
      }


       /* ----- ファイル選択ページ ----- */

      /* Alert風スタイル（info） */
      .alert-info {
        display: flex;
        align-items: flex-start;
        border: 1px solid #2196f3;    /* 情報色のアウトライン */
        background-color: #e3f2fd;     /* 薄い青背景 */
        color: #0d47a1;               /* 濃い青文字 */
        padding: 12px 16px;
        border-radius: 6px;
        font-size: 14px;
        margin-bottom: 15px;
      }

      /* 左のアイコン */
      .alert-icon {
        font-size: 20px;
        margin-right: 10px;
        line-height: 1.2;
      }

      /* テキスト部分 */
      .alert-text {
        line-height: 1.5;
      }

      #dropArea {
        width: 100%;
        height: 150px;
        border: 2px dashed #999;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #666;
        margin-bottom: 15px;
        background-color: #fafafa;
      }

      #selectFileBtn {
        padding: 6px 24px;       /* 縦を6pxにして横を24pxに広げる */
        border-radius: 8px;         /* 角丸を少し強調 */
        border: 1px solid #ccc;
        background: #195ff2;
        cursor: pointer;
        color: #fff;
        font-size: 14px;            /* 文字サイズを調整 */
        font-weight: 600;
      }

      #selectFileBtn:hover { background: #3a76ff; }

      .material-icons { font-size: 22px; vertical-align: middle; }

      .slide-card {
        position: absolute;
        top: 40px; /* ボタンの下あたりに出す */
        left: 0;
        background: #fff;
        border: 1px solid #ccc;
        border-radius: 10px;
        padding: 10px;
        width: 180px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        z-index: 9999; /* 他のテキストに完全にかぶる */
        opacity: 1;
        transition: opacity 0.2s ease, transform 0.2s ease;
      }

      .slide-card.is-hidden {
        opacity: 0;
        transform: translateY(-8px);
        pointer-events: none;
      }

      .slide-card-item {
        padding: 8px;
        border-radius: 6px;
        cursor: pointer;
      }

      .slide-card-item:hover {
        background: #f0f0f0;
      }

      #slideSelectorBtn {
        display: flex;
        align-items: center;
        background-color: #e2e4e7;
        border: 1px solid #bab7b7;
        border-radius: 12px;
        padding: 6px 2px 5px 12px;  /* top:6px, right:4px, bottom:12px, left:12px */
        cursor: pointer;
        margin-top: 15px;
      }

      #slideSelectorBtn .arrow-icon {
        font-size: 30px;
        vertical-align: middle;
      }

      /* ----- 設定ページ ----- */
      
      /* セクションタイトル（小さめグレー） */
      .settings-card h3 {
        font-size: 17px;
        margin-bottom: 10px;
        color: #24292f;
      }

      /* 各フォーム行 */
      .settings-row {
        margin-bottom: -6px;
      }

      /* ラベル */
      .settings-row label {
        display: block;
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 6px;
        color: #24292f;
      }
      
      /* セレクトボックス */
      .settings-row select {
        width: 100%;
        max-width: 300px;
        padding: 6px 8px;
        border: 1px solid #d0d7de;
        border-radius: 6px;
        background: #f6f8fa;
        font-size: 14px;
        color: #24292f;
      }
      
      /* 保存ボタン（GitHub風） */
      #saveSettingBtn {
        padding: 8px 16px;
        background: #195ff2;
        color: #fff;
        border: 1px solid rgba(27,31,36,0.15);
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
      }

      #saveSettingBtn:hover {
        background: #3a76ff;
      }

      #translateBtn {
        padding: 8px 16px;
        background: #195ff2;
        color: #fff;
        border: 1px solid rgba(27,31,36,0.15);
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: background 0.2s;
      }

      #translateBtn:hover {
        background: #3a76ff;
      }

      /* 保存メッセージ */
      #settingSavedMsg {
        color: #195ff2;
        margin-top: 10px;
        font-size: 14px;
        display: none;
      }

      .custom-textarea {
        width: 100%;
        max-width: 100%;
        height: calc(100vh - 200px); /* ← 画面の高さから必要分を差し引く */
        min-height: 150px;          /* 小さすぎ防止 */
        padding: 10px;
        font-size: 16px;
        box-sizing: border-box;
        resize: vertical;
        border-radius: 6px;
        background-color: #f7f7fa;

        border: 1px solid #656363;
        outline: none;
      }

      .custom-textarea:focus {
        border: 2px solid #195ff2; /* ← フォーカス時に青 */
      }

      .custom-textarea-after:focus {
        border: 2px solid #195ff2;
      }

      .custom-textarea-after {
        width: 100%;
        max-width: 100%;
        height: calc(100vh - 200px); /* ← 画面の高さから必要分を差し引く */
        min-height: 150px;          /* 小さすぎ防止 */
        padding: 10px;
        font-size: 16px;
        box-sizing: border-box;
        resize: vertical;
        border-radius: 6px;
        background-color: #f7f7fa;
        border: 1px solid #656363;
        outline: none;
        display:none;
      }
    
     /* ----- モーダル全体（背景） ----- */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.45);
      display: flex;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(3px);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease;
      z-index: 9999; /* ★ サイドメニューより上に表示 */
    }

    /* 表示状態 */
    .modal.show {
      opacity: 1;
      pointer-events: auto;
    }

    /* ----- モーダル本体 ----- */
    .modal-content {
      background: #ffffff;
      padding: 22px 26px;    
      border-radius: 12px;
      text-align: center;
      font-size: 15px;
      box-shadow: 0 12px 28px rgba(0,0,0,0.18);
      transform: scale(0.92);
      transition: transform 0.25s ease;
      max-width: 300px;
      width: 90%;
    }

    /* 表示時アニメーション */
    .modal.show .modal-content {
      transform: scale(1);
    }

    /* ---- テキスト部分 ---- */
    .modal-content p {
      margin: 4px 0 0;
      line-height: 1.5;
      font-size: 14.5px;
      color: #222;
    }

    /* ⚠️ 警告アイコン */
    .modal-content::before {
      content: "⚠️";
      font-size: 28px;
      display: block;
      margin-bottom: 6px;
    }

    /* ------ OKボタン ------ */
    #modal-close-btn {
      margin-top: 16px;
      padding: 8px 22px;
      background: #195ff2;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.2s;
    }

    #modal-close-btn:hover {
      background: #3a76ff;
    }

    /* 右上の × ボタン */
    .modal-close-x {
      position: absolute;
      top: 8px;
      right: 12px;
      background: transparent;
      border: none;
      font-size: 28px;
      color: #666;
      cursor: pointer;
      padding: 4px;
      line-height: 1;
      transition: 0.2s;
    }

    .modal-close-x:hover {
      color: #000;
      transform: scale(1.12);
    }

    /* 非表示 */
    .is-hidden { display: none !important; }
      
    </style>
  </head>

  <body>
    <!-- 固定ヘッダー -->
    <header id="topHeader">
      <div class="header-title">ファイル選択</div>
      <div class="header-filename" id="currentFileName">選択中のファイル名なし</div>
      <button class="header-save-btn" id="headerSaveBtn">保存</button>
    </header>

    <!-- 左サイドバー -->
    <aside id="sidebar">
      <h2 class="sidebar-title">Document Master</h2>
      
      <div class="menu-div" data-target="file-section">
        <span class="material-icons">file_open</span>
        <span class="menu-item">ファイル選択</span>
      </div>

      <div class="menu-div" data-target="translate-section">
        <span class="material-icons">translate</span>
        <span class="menu-item">翻訳</span>
      </div>

      <div class="menu-div" data-target="textarea-section">
        <span class="material-icons">edit_note</span>
        <span class="menu-item">入力</span>
      </div>

      <div class="menu-div" data-target="setting-section">
        <span class="material-icons">settings</span>
        <span class="menu-item">設定</span>
        
      </div>
    
    </aside>

    <!-- メインコンテンツ -->
    <div id="mainContent">

      <!-- ファイルページ -->
      <div id="file-section" class="page is-hidden">
        
        <div class="alert-info">
          <span class="alert-icon">ℹ️</span>
          <span class="alert-text">
            翻訳したい資料をドラッグ＆ドロップ<br>
            またはファイルを選択
          </span>
        </div>

        <div id="dropArea">ドラッグ＆ドロップしてください</div>
        <input type="file" id="fileInput" style="display:none;">
        <button id="selectFileBtn">ファイルを選択</button>
        <p id="selectedFileName" style="margin-top:10px; color:#333;"></p>
      </div>

      <!-- 設定ページ -->
      <div id="setting-section" class="page is-hidden">

        <!-- 使用モデル選択 -->
        <div class="settings-card">
          <h3>モデル選択</h3>
          <div class="settings-row">
            <label for="modelSelect">モデル</label>
            <select id="modelSelect">
              <option value="gpt-4">GPT-4</option>
              <option value="gpt-4o">GPT-4o</option>
              <option value="gpt-5">GPT-5</option>
            </select>
          </div>
      
        <br><br>

        <!-- 言語選択 -->
        <h3>言語</h3>
        <div class="settings-row">
          <label for="langSelect">翻訳言語</label>
          <select id="languageSelect">
            <option value="ja">日本語</option>
            <option value="en">English</option>
            <option value="zh">中文</option>
            <option value="ko">한국어</option>
          </select>
        </div>

        <br><br>

        <!-- ハードウェア選択 -->
        <h3>ハードウェア設定</h3>
        <div class="settings-row">
          <label for="hardwareSelect">処理モード</label>
          <select id="hardwareSelect">
            <option value="cpu">CPU</option>
            <option value="gpu">GPU</option>
            <option value="auto">AUTO（自動選択）</option>
        </select>
      </div>

        <br><br>

        <button id="saveSettingBtn">設定を保存</button>
        <p id="settingSavedMsg">設定を保存しました！</p>

      </div>
    </div>

      <!-- 翻訳ページ -->
      <div id="translate-section" class="page is-hidden">
      
        <div id="translation-container">

          <button id="slideSelectorBtn">
            スライド（<span id="slideCountText">0 / 0</span>）
            <span class="material-icons arrow-icon">arrow_drop_down</span>
          </button>
        
          <div id="slideSelectorList" class="slide-card is-hidden"></div>
                
          <p id="filePathLabel"></p>
          <p id="slideNumber"></p>
          <!-- <button id="test">test</button> -->

          <div style="display: flex; justify-content: flex-end; align-items: center; gap: 10px;">
            <button id="beforeBtn" style="color: red; border: none; padding: 8px 16px; background: transparent; cursor: pointer;"
                    onmouseover="this.style.color='darkred'" 
                    onmouseout="this.style.color='red'">
              before
            </button>
            <p style="margin: 0;">/</p>
            <button id="afterBtn" style="color: blue; border: none; padding: 8px 16px; background: transparent; cursor: pointer;"
                    onmouseover="this.style.color='darkblue'" 
                    onmouseout="this.style.color='blue'">
              after
            </button>
          </div>
              
          <textarea id="before" class="custom-textarea"></textarea>
          <textarea id="after" class="custom-textarea-after"></textarea>       

          <div style="text-align: right;">
            <button id="translateBtn">翻訳</button>
          </div>
          
          <ul id="listDisplay"></ul>
          <button id="replaceBtn">選択行を置換</button>
          <div id="slideContainer"></div>
          <!-- <button id="savetest">セーブテスト</button> -->
          <div id="shapeInfo"></div>
          <button id="saveBtn">保存</button>
        </div>

        <div id="translated-text"></div>
        <!-- <button id="savefileBtn">保存するよ</button> -->
      </div>
    
      <!-- 入力（Google翻訳風UI） -->
      <div id="textarea-section" class="page is-hidden">

        <div class="translate-container">
          <div class="translate-column">
            <h3>英語入力</h3>
            <textarea id="inputText" class="translate-textarea" placeholder="Enter text"></textarea>
          </div>
          <div class="translate-column">
            <h3>翻訳結果（日本語）</h3>
            <textarea id="outputText" class="translate-textarea" placeholder="テキストが表示"></textarea>
          </div>
        </div>

        <!-- PPTX 設定 -->
        <div class="pptx-setting">
          <label>Left（インチ）:</label>
          <input type="number" id="left-input" value="2" step="0.1" min="0" max="15">
          <label>Top（インチ）:</label>
          <input type="number" id="top-input" value="2" step="0.1" min="0" max="10">
          <label>Width（インチ）:</label>
          <input type="number" id="width-input" value="4" step="0.1">
          <label>Height（インチ）:</label>
          <input type="number" id="height-input" value="1.5" step="0.1">
        </div>

        <div class="info-alert">
        <span class="icon-alert">ℹ️</span>
        <span class="text-alert">
          デフォルトサイズ（PowerPoint標準）<br>
          通常の標準(4:3) → Left:10インチ × Top:7.5インチ<br>
          ワイドスクリーン(16:9) → Left:13.333インチ × Top:7.5インチ<br>
          Width（textboxの横幅）<br>
          Height（textboxの縦幅）<br>
          1インチ=2.54センチ<br>
        <span class="alert-danger-text">※この基準を超えるとスライドからはみ出す可能性があります。</span>
        </span>
        </div>

      <div id="insert-btn-container">
        <button id="insert-btn">挿入する</button>
      </div>
      </div>

      <!-- ▼ ファイル未選択モーダル -->
    <div id="file-alert-modal" class="modal is-hidden">
      <div class="modal-content">

    <!-- 右上 × ボタン -->
    <button class="modal-close-x" id="modal-close-x">×</button>

    <p id="file-alert-title">
      ファイルが選択されていません。<br>
      ページを移動する前に、ファイルを選択してください。
    </p>
    <button id="modal-close-btn">OK</button>
  </div>
</div>


    <!-- JS -->
    <script src="renderer.js"></script>
    <script src="insert.js"></script>
    <script src="translate.js"></script>
  
    <script>
    /*===========================
      状態管理
    ===========================*/
    let fileSelected = false;

    document.getElementById("fileInput").addEventListener("change", () => {
      fileSelected = true;
    });

    /*===========================
      モーダル制御
    ===========================*/
    const modal = document.getElementById("file-alert-modal");
    const modalCloseBtn = document.getElementById("modal-close-btn");
    const modalCloseX = document.getElementById("modal-close-x");

    function showFileSelectModal() {
      modal.classList.remove("is-hidden");
      setTimeout(() => modal.classList.add("show"), 10);
    }

    function hideFileSelectModal() {
      modal.classList.remove("show");
      setTimeout(() => modal.classList.add("is-hidden"), 250);
    }

    /*===========================
      ページ切替（共通）
    ===========================*/
    const pages = document.querySelectorAll(".page");
    const headerTitle = document.querySelector(".header-title");

    const sectionTitles = {
      "file-section": "ファイル選択",
      "translate-section": "翻訳",
      "textarea-section": "入力",
      "setting-section": "設定"
    };

    function goToFileSelectPage() {
      pages.forEach(p => p.classList.add("is-hidden"));
      document.getElementById("file-section").classList.remove("is-hidden");
      headerTitle.textContent = "ファイル選択";
    }

    /*===========================
      OK / × ボタン
    ===========================*/
    modalCloseBtn.addEventListener("click", () => {
      hideFileSelectModal();
      goToFileSelectPage();
    });

    modalCloseX.addEventListener("click", () => {
      hideFileSelectModal();
      goToFileSelectPage();
    });

    /*===========================
      メニュークリック（1か所に統一）
    ===========================*/
    document.querySelectorAll(".menu-div").forEach(div => {
      div.addEventListener("click", () => {

        const target = div.dataset.target;

        // ファイル未選択ならモーダル表示
        if (!fileSelected && 
            target !== "file-section" && 
            target !== "setting-section") {
          showFileSelectModal();
          return;
        }

        // ページ切替
        pages.forEach(p => p.classList.add("is-hidden"));
        document.getElementById(target).classList.remove("is-hidden");

        // タイトル変更
        headerTitle.textContent = sectionTitles[target] || "Document Master";
      });
    });


  </script>

  <script>
    
      // 初期ページ
      document.getElementById('file-section').classList.remove('is-hidden');

      // ファイル選択処理
      const dropArea = document.getElementById("dropArea");
      const fileInput = document.getElementById("fileInput");
      const selectFileBtn = document.getElementById("selectFileBtn");
      const selectedFileName = document.getElementById("selectedFileName");

      dropArea.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropArea.style.borderColor = "#666";
        dropArea.style.backgroundColor = "#f0f0f0";
      });

      dropArea.addEventListener("dragleave", () => {
        dropArea.style.borderColor = "#999";
        dropArea.style.backgroundColor = "#fafafa";
      });

      dropArea.addEventListener("drop", (e) => {
        e.preventDefault();
        dropArea.style.borderColor = "#999";
        dropArea.style.backgroundColor = "#fafafa";

        const files = e.dataTransfer.files;
        if (files.length > 0) {
          selectedFileName.textContent = files[0].name;
          console.log(files[0]);
        }
      });

      // selectFileBtn.addEventListener("click", () => fileInput.click());

      fileInput.addEventListener("change", () => {
        if (fileInput.files.length > 0) {
          selectedFileName.textContent = fileInput.files[0].name;
          console.log(fileInput.files[0]);
        }
      });

    </script>


    <script>
      const beforeBtn = document.getElementById('beforeBtn');
      const afterBtn = document.getElementById('afterBtn');
      const beforeArea = document.getElementById('before');
      const afterArea = document.getElementById('after');

      beforeBtn.addEventListener('click', () => {
        beforeArea.style.display = 'block';
        afterArea.style.display = 'none';
      });

      afterBtn.addEventListener('click', () => {
        beforeArea.style.display = 'none';
        afterArea.style.display = 'block';
      });
    </script>

  </body>
</html>
